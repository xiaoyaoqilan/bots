# ==============================================================================
# Hyperliquid BTC 永续合约做空网格配置文件
# ==============================================================================
# 
# 🎯 当前配置：价格移动网格 + 四重保护（剥头皮 + 本金保护 + 止盈 + 价格锁定）
# 
# 📋 本文件包含所有网格模式，需要切换时取消对应注释即可：
#    ✅ 价格移动网格（当前启用）
#    📝 固定范围网格（注释中，可启用）
#    📝 马丁模式（注释中，可启用）
# 
# ==============================================================================

grid_system:
  # ============================================================================
  # 基础配置
  # ============================================================================
  exchange: "hyperliquid"
  symbol: "BTC/USDC:USDC"  # Hyperliquid BTC永续合约（原生格式）
  
  # ----------------------------------------------------------------------------
  # 网格类型选择（三选一，其他两个需注释）
  # ----------------------------------------------------------------------------
  grid_type: "follow_short"        # ✅ 当前：价格移动做空网格
  # grid_type: "short"             # 📝 备选：固定范围做空网格
  # grid_type: "martingale_short"  # 📝 备选：固定范围做空马丁网格
  
  # ============================================================================
  # 价格移动网格参数（grid_type = "follow_short" 时生效）
  # ============================================================================
  follow_grid_count: 200      # 总共200个网格
  follow_timeout: 1500         # 脱离超时25分钟
  follow_distance: 2          # 脱离距离2格
  price_offset_grids: 5       # 🆕 价格偏移网格数（默认0）
  # 说明：调整网格启动时的价格边界位置，让当前价格处于网格内部
  # - 默认值0：以当前价格为边界（旧行为）
  # - 做空网格：当前价格 - 5格 = 下边界，然后向上计算上边界
  #           例如：当前价格$100,000，grid_interval=$100，则下边界=$99,500
  #                 网格范围：$99,500（下边界）~ $119,500（上边界）
  #                 当前价格$100,000在网格内部，可立即触发卖单
  # - 推荐值：3-10格（让当前价格处于网格内部靠近边界的位置）
  # - 适用场景：所有重置（剥头皮、脱离、止盈）都使用此配置
  # ----------------------------------------------------------------------------
  # 固定范围网格参数（grid_type = "short" 或 "martingale_short" 时生效）
  # 需要启用固定范围网格时，取消下面3行注释，并注释掉上面的follow参数
  # ----------------------------------------------------------------------------
  # lower_price: 80000.00      # 📝 网格下限价格 $80,000
  # upper_price: 100000.00     # 📝 网格上限价格 $100,000
  # # 网格数量会根据 (upper_price - lower_price) / grid_interval 自动计算
  
  # ============================================================================
  # 通用网格参数（所有网格类型都需要）
  # ============================================================================
  grid_interval: 100        # 每格间隔 $100
  order_amount: 0.0002      # 每格基础数量 0.0002 BTC
  quantity_precision: 5     # 🔥 BTC数量精度（5位小数，支持0.00001）
  
  # ----------------------------------------------------------------------------
  # 马丁模式参数（grid_type = "martingale_short" 时生效）
  # 需要启用马丁模式时，取消下面1行注释
  # ----------------------------------------------------------------------------
  # martingale_increment: 0.00001  # 📝 马丁递增数量（每格增加0.00001 BTC）
  #                                #    例如：第1格0.0002, 第2格0.00021, 第3格0.00022...
  
  # 🎯 剥头皮模式配置（第一道防线）
  scalping_enabled: true               # ✅ 启用剥头皮
  scalping_trigger_percent: 40         # 🔔 触发阈值40%（从底部往上涨40%时触发）
  scalping_take_profit_grids: 2        # 📊 止盈2格（向下2格）
  # 说明：40% = 从Grid 1往上涨到Grid 80（1 + 200*40% = 81）
  
  # 🛡️ 本金保护模式配置（第二道防线）
  capital_protection_enabled: false     # ✅ 启用本金保护
  capital_protection_trigger_percent: 30  # 🔔 触发阈值30%（从底部往上涨30%时触发）
  # 说明：30% = 从Grid 1往上到Grid 60（1 + 200*30% = 61）
  # ⚠️ 测试用可设置1-5%（轻微上涨即触发），实战建议30-50%
  
  # 💰 止盈模式配置（盈利保护）
  take_profit_enabled: false            # ✅ 启用止盈模式
  take_profit_percentage: 0.002        # 🎯 止盈阈值0.2%（盈利超过本金0.2%时止盈）
  
  # 🔒 价格锁定模式配置（智能冻结）
  price_lock_enabled: true             # ✅ 启用价格锁定模式
  price_lock_threshold: 75000.0        # 🎯 锁定价格阈值 $75,000（价格向下脱离且<=阈值时锁定）
  price_lock_start_at_threshold: false  # 🆕 启动时使用阈值作为起点（仅价格移动网格FOLLOW模式生效）
  
  # 做空网格说明：
  # - 当价格向下脱离网格范围时（盈利方向）
  # - 如果价格 <= $75,000，则冻结网格（不平仓止盈）
  # - 保留订单和持仓，等待价格回升
  # - 价格回到网格范围内时，自动解除冻结
  
  # 🛑 止损保护模式配置（亏损方向脱离保护，优先级最高）
  stop_loss_protection_enabled: false  # ✅ 启用止损保护模式
  stop_loss_trigger_percent: 95.0      # 🎯 触发百分比（%）- 从网格底部往不利方向移动的百分比
  stop_loss_escape_timeout: 450        # 🔔 脱离超时（秒）- 做空风险大，设置450秒
  stop_loss_apr_threshold: 50.0        # 📊 APR阈值（%）- 实时APR>=50%→重置，<50%→停止
  # 说明：
  # - 做空网格：价格涨破上边界且持续450秒 → 触发止损保护
  # - 判断实时循环APR（过去10分钟）：
  #   * APR ≥ 50% → 市价平仓 → 取消订单 → 重置网格（重新开始）
  #   * APR < 50% → 市价平仓 → 取消订单 → 停止程序（退出）
  # - 优先级：最高（覆盖所有其他模式）
  
  # 🎯 反手挂单格子距离配置（利润优化）
  reverse_order_grid_distance: 1       # 🔥 反手挂单距离（默认1格，可自定义提高利润）
  # 说明：成交后反手挂单的格子距离
  # - 默认值1：卖单成交@$100,000 → 买单挂@$99,900（间隔1格）
  # - 设置为2：卖单成交@$100,000 → 买单挂@$99,800（间隔2格，利润提高）
  # - 设置为3：卖单成交@$100,000 → 买单挂@$99,700（间隔3格，利润更高）
  # - 推荐范围：1-5格（格数越高利润越大，但成交概率降低）
  # - 适用场景：震荡行情可适当提高，单边行情保持默认值
  
  # 🔍 订单健康检查间隔配置（系统维护）
  order_health_check_interval: 600     # 🕐 健康检查间隔（秒，默认600秒=10分钟）
  # 说明：定期检查订单健康状态
  # - 默认值：600秒（10分钟）
  # - 推荐范围：300-900秒（5-15分钟）
  # - 设置太短：频繁检查，可能影响性能
  # - 设置太长：问题发现不及时
  # - 实战建议：600秒（10分钟）
  
  # 🔄 REST持仓查询配置
  rest_position_query_interval: 1      # REST持仓查询间隔（秒，默认1秒）
  # 说明：通过REST API定时查询持仓数据，用于网络监控和数据同步
  # - 默认1秒：适应剧烈波动，快速检测网络故障（5次失败=5秒检测）
  # - 可调整为3-5秒：降低API调用频率，适合稳定网络环境
  # - 建议：生产环境1-2秒，测试环境可调高至5秒
  
  # 四重保护说明（做空方向）：
  # 1. 剥头皮（40%）：价格从Grid 1上涨到Grid 80（上涨40%）→ 取消买单 → 挂止盈买单 → 止盈成交后重置
  # 2. 本金保护（30%）：价格从Grid 1上涨到Grid 60（上涨30%）→ 等待抵押品回本 → 回本后重置
  # 3. 止盈模式（0.2%）：盈利超过本金0.2% → 平仓 → 重置网格
  # 4. 价格锁定（$75,000）：价格向下脱离 <= $75,000 → 冻结网格 → 等待价格回升
  # 
  # 触发优先级：哪个先触发就执行哪个，执行后所有管理器都重置

# ==============================================================================
# 💡 Hyperliquid BTC 永续合约做空网格使用建议：
# ==============================================================================
# 
# 1. 网格参数调整：
#    - 如果价格波动剧烈，可以：
#      a. 增大 grid_interval（比如调整为 $200）
#      b. 减少 order_amount（比如调整为 0.0001 BTC）
#      c. 调整 follow_grid_count（比如调整为 150个）
#
# 2. 剥头皮触发百分比：
#    - 40% 较为适中（卖单成交40%才触发）
#    - 可以调整为 30% 更早触发保护
#
# 3. 本金保护触发百分比：
#    - 30% 是兜底保护（卖单成交30%）
#    - 可以调整为 40% 或 50%
#
# 4. 价格锁定阈值：
#    - 当前 $75,000（假设网格下限约$80,000）
#    - 应该设置在网格下限之下20%-30%
#    - 防止正常下跌就触发锁定
#
# 5. 止盈百分比：
#    - 当前 0.2%（保守）
#    - 可以调整为 0.5% 或更高
#    - 根据风险偏好调整
#
# ==============================================================================
# 📊 做多 vs 做空对比：
# ==============================================================================
#
# | 项目 | 做多 | 做空 |
# |------|------|------|
# | 不利方向 | 价格下跌 | 价格上涨 |
# | 有利方向 | 价格上涨 | 价格下跌 |
# | 剥头皮触发 | 买单成交40%（价格↓） | 卖单成交40%（价格↑） |
# | 剥头皮操作 | 取消卖单，挂止盈卖单 | 取消买单，挂止盈买单 |
# | 本金保护触发 | 买单成交30%（价格↓↓） | 卖单成交30%（价格↑↑） |
# | 本金保护 | 等待价格反弹回本 | 等待价格回落回本 |
# | 价格锁定条件 | 价格>=阈值（向上脱离） | 价格<=阈值（向下脱离） |
# | 盈利方式 | 价格上涨 | 价格下跌 |
#
# ==============================================================================
# 🎯 Hyperliquid 特点：
# ==============================================================================
# - 零手续费 Maker 订单
# - 高杠杆支持（最高50x）
# - 深度流动性
# - 永续合约交易
# - 快速成交
#
# 建议：利用零手续费优势，设置较小的 grid_interval 增加成交频率

