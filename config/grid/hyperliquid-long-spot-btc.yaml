# ==============================================================================
# Hyperliquid BTC 现货做多网格配置文件
# ==============================================================================
# 
# ⚠️ 重要：Hyperliquid的BTC现货符号是 UBTC/USDC
# ⚠️ 现货交易只支持做多，不支持做空
# 
# 🎯 当前配置：价格移动网格 + 四重保护（剥头皮 + 本金保护 + 止盈 + 价格锁定）
# 
# 📋 本文件包含所有网格模式，需要切换时取消对应注释即可：
#    ✅ 价格移动网格（当前启用）
#    📝 固定范围网格（注释中，可启用）
#    📝 马丁模式（注释中，可启用）
# 
# ==============================================================================

grid_system:
  # ============================================================================
  # 基础配置
  # ============================================================================
  exchange: "hyperliquid"
  symbol: "UBTC/USDC"  # ✅ Hyperliquid BTC现货（市场ID: @142）
  
  # ----------------------------------------------------------------------------
  # 网格类型选择（仅支持做多，其他两个需注释）
  # ⚠️ 注意：现货只能选择做多类型（long/martingale_long/follow_long）
  # ----------------------------------------------------------------------------
  grid_type: "follow_long"         # ✅ 当前：价格移动做多网格
  # grid_type: "long"              # 📝 备选：固定范围做多网格
  # grid_type: "martingale_long"   # 📝 备选：固定范围做多马丁网格
  
  # ============================================================================
  # 价格移动网格参数（grid_type = "follow_long" 时生效）
  # ============================================================================
  follow_grid_count: 100      # 总共100个网格
  follow_timeout: 60         # 脱离超时25分钟
  follow_distance: 1          # 脱离距离2格
  price_offset_grids: 1       # 🆕 价格偏移网格数（默认0）
  # 说明：调整网格启动时的价格边界位置，让当前价格处于网格内部
  # - 默认值0：以当前价格为边界（旧行为）
  # - 做多网格：当前价格 + 5格 = 上边界，然后向下计算下边界
  #           例如：当前价格$100,000，grid_interval=$100，则上边界=$100,500
  #                 网格范围：$90,500（下边界）~ $100,500（上边界）
  #                 当前价格$100,000在网格内部，可立即触发买单
  # - 推荐值：3-10格（让当前价格处于网格内部靠近边界的位置）
  # - 适用场景：所有重置（剥头皮、脱离、止盈）都使用此配置
  # ----------------------------------------------------------------------------
  # 固定范围网格参数（grid_type = "long" 或 "martingale_long" 时生效）
  # 需要启用固定范围网格时，取消下面3行注释，并注释掉上面的follow参数
  # ----------------------------------------------------------------------------
  # lower_price: 80000.00      # 📝 网格下限价格 $80,000
  # upper_price: 100000.00     # 📝 网格上限价格 $100,000
  # # 网格数量会根据 (upper_price - lower_price) / grid_interval 自动计算
  
  # ============================================================================
  # 通用网格参数（所有网格类型都需要）
  # ============================================================================
  grid_interval: 100        # 每格间隔 $100
  order_amount: 0.0001      # 每格基础数量 0.0001 BTC
  quantity_precision: 5     # 🔥 BTC数量精度（5位小数，支持0.00001）
  
  # ----------------------------------------------------------------------------
  # 马丁模式参数（grid_type = "martingale_long" 时生效）
  # 需要启用马丁模式时，取消下面1行注释
  # ----------------------------------------------------------------------------
  martingale_increment: 0.000005  # 📝 马丁递增数量（每格增加0.00001 BTC）
  #                                #    例如：第1格0.0001, 第2格0.00011, 第3格0.00012...
  
  # 🎯 剥头皮模式配置（第一道防线）
  scalping_enabled: true               # ✅ 启用剥头皮
  scalping_trigger_percent: 2         # 🔔 触发阈值40%（从顶部往下跌40%时触发）
  scalping_take_profit_grids: 1        # 📊 止盈2格（向上2格）
  # 说明：40% = 从Grid 100往下跌到Grid 60（100 - 100*40% = 60）
  
  # 🛡️ 本金保护模式配置（第二道防线）
  capital_protection_enabled: false     # 📝 启用本金保护
  capital_protection_trigger_percent: 30  # 🔔 触发阈值30%（从顶部往下跌30%时触发）
  # 说明：30% = 从Grid 100往下到Grid 70（100 - 100*30% = 70）
  # ⚠️ 测试用可设置1-5%（轻微下跌即触发），实战建议30-50%
  
  # 💰 止盈模式配置（盈利保护）
  take_profit_enabled: false            # 📝 启用止盈模式
  take_profit_percentage: 0.002        # 🎯 止盈阈值0.2%（盈利超过本金0.2%时止盈）
  # 说明：当盈亏达到初始本金的0.2%时触发止盈
  # 示例：初始本金10000 USDC，盈利20 USDC（0.2%）时止盈
  
  # 🔒 价格锁定模式配置（极端行情保护）
  price_lock_enabled: true             # ✅ 启用价格锁定
  price_lock_threshold: 125000.0       # 🔒 锁定阈值$125,000（价格超过此值时锁定）
  # 说明：当价格突破$125,000时，停止挂单，等待价格回落
  # 适用场景：防止价格暴涨时追高，等待回调再进场
  
  # 🛑 止损保护模式配置（亏损方向脱离保护，优先级最高）
  stop_loss_protection_enabled: false  # ✅ 启用止损保护模式
  stop_loss_trigger_percent: 95.0      # 🎯 触发百分比（%）- 从网格顶部往不利方向移动的百分比
  stop_loss_escape_timeout: 600        # 🔔 脱离超时（秒）- BTC现货波动较小，设置600秒
  stop_loss_apr_threshold: 40.0        # 📊 APR阈值（%）- 实时APR>=40%→重置，<40%→停止
  # 说明：
  # - 做多网格：价格跌破下边界且持续600秒 → 触发止损保护
  # - 判断实时循环APR（过去10分钟）：
  #   * APR ≥ 40% → 市价平仓 → 取消订单 → 重置网格（重新开始）
  #   * APR < 40% → 市价平仓 → 取消订单 → 停止程序（退出）
  # - 优先级：最高（覆盖所有其他模式）
  
  # ============================================================================
  # 风控参数（所有模式共用）
  # ============================================================================
  max_position: null           # ⚠️ 现货无杠杆，最大持仓由账户余额决定
  enable_notifications: false  # 🔔 禁用通知（可选）
  order_health_check_interval: 300  # ⏰ 订单健康检查间隔（秒）
  rest_position_query_interval: 1   # 🔄 REST持仓查询间隔（秒，默认1秒）
  fee_rate: 0.0002            # 💰 手续费率（万分之1）
  
  # ============================================================================
  # 反手挂单距离（可选配置）
  # ============================================================================
  reverse_order_distance: 1    # 🔄 反手挂单距离（网格数）
  # 说明：买单成交后，在上方1格挂卖单；卖单成交后，在下方1格挂买单
  # 默认值：1格（标准网格策略）
  # 可选值：1-10格（根据波动性调整）
  
  # ============================================================================
  # 其他配置
  # ============================================================================
  # 🔥 这些配置通常无需修改，保持默认即可
  enable_order_health_check: true     # ✅ 启用订单健康检查
  enable_position_monitor: true       # ✅ 启用持仓监控
  enable_balance_monitor: true        # ✅ 启用余额监控
  
# ==============================================================================
# 📝 使用说明
# ==============================================================================
# 
# 1. Hyperliquid BTC现货符号说明
#    - 现货符号: UBTC/USDC (市场ID: @142)
#    - 永续符号: BTC/USDC:USDC (市场ID: 0)
#    ⚠️ 注意：UBTC是Hyperliquid的BTC现货代号，不是其他代币
# 
# 2. 启动命令
#    python run_grid_trading.py config/grid/hyperliquid_btc_spot_long.yaml
# 
# 3. 风险提示
#    - 现货无杠杆，但需要足够的USDC余额来挂买单
#    - 现货只能做多，不能做空
#    - 建议从小额开始测试
# 
# 4. 网格模式选择
#    - follow_long: 价格跟随，适合震荡行情
#    - long: 固定范围，适合明确的区间震荡
#    - martingale_long: 马丁模式，高风险高收益
# 
# ==============================================================================

  # ============================================================================
  # 现货预留管理配置（仅现货需要）
  # ============================================================================
  spot_reserve:
    # 是否启用预留管理
    enabled: true
    
    # 预留BTC数量（用户填写）
    # - 建议值：order_amount * 100 * fee_rate * 10
    # - 示例：0.0001 * 100 * 0.0002 * 10 = 0.0002 BTC
    # - 可支持的交易次数：reserve / (order_amount * fee_rate)
    reserve_amount: 0.001  # 预留0.01 BTC（约5000次买入）
    
    # 现货买入手续费率（万分之3.8）
    # 
    # 📊 手续费率计量单位说明：
    # - 计量单位：小数形式（0.00038 = 万分之3.8 = 0.038%）
    # - 换算关系：
    #   * 0.00038 = 3.8 / 10000 = 万分之3.8
    #   * 0.00038 = 0.038 / 100 = 0.038%
    #   * 0.00038 = 0.00038 = 小数形式（配置使用）
    # 
    # ⚠️ 重要：买入BTC时，手续费从到账的BTC中扣除（不是从USDC扣除）
    # 
    # 💡 示例计算：
    # - 下单买入：0.0001 BTC
    # - 手续费：0.0001 * 0.00038 = 0.000000038 BTC
    # - 实际到账：0.0001 - 0.000000038 = 0.099999962 BTC
    # 
    # 🔄 预留消耗计算：
    # - 每次买入消耗预留：order_amount * spot_buy_fee_rate
    # - 100次买入后消耗：0.0001 * 100 * 0.00038 = 0.0038 BTC
    spot_buy_fee_rate: 0.00038  # 万分之3.8（小数形式）
    
    # 自动补充配置
    auto_replenish:
      # 是否启用自动补充
      enabled: true
      
      # 触发补充的阈值（百分比）
      # 当预留 < reserve_amount * trigger_percent 时触发
      trigger_percent: 0.50  # 50%（健康度低于50%时触发）
      
      # 补充目标（百分比）
      # 补充到 reserve_amount * target_percent
      target_percent: 1.0  # 100%（补充到初始值）
      
      # 补充方式
      order_type: "market"  # market=市价单（快速成交）
      
      # 最小补充金额（USDC）
      # 说明：Hyperliquid 最小下单金额为 10 USDC
      # 建议设置为 12 USDC 以保留容错空间
      # 如果补充金额价值 < min_order_value_usdc，则跳过补充
      min_order_value_usdc: 12.0  # 最小补充价值（USDC）
      
      # 最大补充次数限制（防止异常）
      max_replenish_per_day: 10  # 每天最多补充10次
      
      # 补充间隔（秒）
      min_replenish_interval: 300  # 最少间隔5分钟
    
    # 启动时检查
    startup_check:
      # 启动时如果预留不足，是否自动购买
      auto_buy_on_startup: true
      
      # 如果自动购买失败，是否继续启动
      continue_on_failure: false  # false=购买失败则终止启动
  
  # ============================================================================
  # 健康检查容错配置
  # ============================================================================
  position_tolerance:
    # 持仓误差容忍度（单位：order_amount的倍数）
    # 例如：tolerance_multiplier=1.0 表示允许误差 = 1 * order_amount
    tolerance_multiplier: 1.0
    
    # 说明：
    # - 由于手续费、交易所四舍五入等原因，持仓可能有细微差异
    # - 只要差异 <= order_amount * tolerance_multiplier，就判定为正常
    # - 这避免了因微小误差导致的错误告警

